# 产品数据智能匹配系统 v3.0

## 项目背景

### 🎯 **业务需求背景**
在当今数字化时代，推荐算法系统已成为电商、内容平台、娱乐应用等领域的核心竞争力。一个高效的推荐系统需要大量高质量的数据支撑，包括：

- **用户行为数据**：用户偏好、浏览历史、交互行为
- **产品特征数据**：产品属性、分类标签、相似度关系
- **公司背景数据**：企业信息、品牌关联、市场定位
- **跨平台数据**：多源数据整合、数据一致性验证

### 🔍 **数据采集挑战**
传统的数据采集方式面临以下挑战：

1. **数据分散性**：产品信息分散在多个平台和数据库中
2. **数据不一致性**：同一产品在不同平台可能有不同的名称和描述
3. **数据完整性**：缺乏统一的产品标识和公司关联信息
4. **采集效率低**：串行处理导致大规模数据采集耗时过长
5. **API限制**：第三方平台API调用频率限制和错误处理复杂

### 💡 **解决方案设计**
本项目设计了一个基于异步爬虫的智能数据匹配系统，专门解决推荐算法系统的数据采集需求：

- **多源数据整合**：从不同平台采集产品、公司、用户偏好数据
- **智能匹配算法**：通过字符串相似度算法实现跨平台数据关联
- **高并发处理**：异步爬虫引擎提升数据采集效率
- **数据质量保证**：完整的日志记录和错误处理机制

## 版本概述

**v3.0 异步爬虫版本** - 基于 `asyncio` 和 `aiohttp` 实现的高并发异步数据处理系统，显著提升大规模数据处理效率，支持智能批次管理和完整的日志记录功能。

## 功能特性

### 🔄 **异步处理引擎**
- **高并发处理**: 支持2-20个并发请求，处理速度提升3-8倍
- **智能批次管理**: 可配置批次大小（10-500），优化内存使用和API效率
- **自适应限流**: 动态调整请求间隔，避免503错误
- **断点续传**: 支持从上次中断的地方继续处理

### 📊 **数据处理功能**
- **多种匹配模式**: 同步/异步原始匹配、同步/异步别名匹配
- **智能匹配算法**: 精确匹配、模糊匹配、会社匹配
- **Excel文件支持**: 自动处理多种数据格式
- **会社信息获取**: 自动获取和匹配游戏会社详细信息

### 📝 **日志管理系统**
- **完整API日志**: 所有API请求和响应记录到logs目录
- **静默模式**: 控制台输出简洁，详细信息保存到日志文件
- **错误追踪**: 详细的错误处理和重试机制日志
- **性能统计**: 实时显示处理进度和成功率

### 🎯 **交互式操作**
- **文件选择**: 交互式选择data目录中的Excel文件
- **模式选择**: 支持5种匹配模式选择
- **批次配置**: 可自定义批次大小，优化性能
- **性能对比**: 内置同步vs异步性能测试

## 项目结构

```
Spider Project/
├── src/                    # 源代码目录
│   ├── api/               # API客户端
│   │   └── api_client.py  # 月幕API客户端
│   ├── async_spider/      # 异步爬虫模块
│   │   ├── async_spider_engine.py    # 异步爬虫引擎
│   │   ├── async_matching_engine.py  # 异步匹配引擎
│   │   └── buffer_manager.py         # 缓冲池管理器
│   ├── core/              # 核心控制器
│   │   └── main_controller.py
│   ├── data/              # 数据处理
│   │   └── data_processor.py
│   ├── matching/          # 匹配引擎
│   │   └── matching_engine.py
│   ├── organization/      # 会社管理
│   │   └── organization_manager.py
│   └── utils/             # 工具类
│       └── logger.py      # 日志管理
├── data/                  # 输入数据目录
├── save/                  # 输出结果目录
├── logs/                  # 日志文件目录
├── main.py               # 主程序入口
├── requirements.txt      # 依赖包列表
└── README.md            # 项目说明
```

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 准备数据

将需要匹配的Excel文件放入`data/`目录。

### 3. 运行程序

```bash
python main.py
```

程序会提示你选择：
- 匹配模式（5种模式可选）
- 源文件（从data目录中选择）
- 批次大小（异步模式）

### 4. 查看结果

匹配结果会保存在`save/`目录中，日志文件保存在`logs/`目录。

## 匹配模式说明

### 1. 同步原始匹配
- 使用日文名和中文名进行匹配
- 适合小数据集，处理稳定
- 串行处理，速度较慢

### 2. 同步别名匹配
- 使用别名列进行匹配
- 支持多个别名同时搜索
- 适合有丰富别名数据的情况

### 3. 异步原始匹配（推荐）
- 高并发处理，速度提升3-8倍
- 支持自定义批次大小
- 适合大数据集处理

### 4. 异步别名匹配（推荐）
- 异步处理别名匹配
- 高并发，支持大批量数据
- 智能错误处理和重试

### 5. 性能对比测试
- 自动对比同步vs异步性能
- 显示速度提升倍数
- 提供性能优化建议

## 配置参数

### 异步引擎配置

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `max_concurrent` | 8 | 最大并发请求数 |
| `buffer_size` | 500 | 缓冲区大小（条记录） |
| `write_interval` | 1.0 | 写入间隔（秒） |
| `batch_size` | 50 | 批次大小（可配置） |

### 性能优化建议

- **小数据集** (< 100条): 批次大小 10-25，并发数 3-5
- **中等数据集** (100-1000条): 批次大小 50-100，并发数 5-8
- **大数据集** (> 1000条): 批次大小 100-200，并发数 8-12
- **503错误频繁**: 批次大小 25-50，并发数 2-3

## 日志功能

### 日志文件
- **位置**: `logs/`目录
- **格式**: `api_responses_YYYYMMDD_HHMMSS.log`
- **内容**: 完整的API请求、响应和错误信息

### 日志记录内容
- API搜索响应（游戏匹配结果）
- 会社信息发现记录
- 会社详情API响应
- 错误信息（Token失效、503错误等）
- 重要操作记录

## 与同步版本对比

| 特性 | 同步版本 | 异步版本 |
|------|----------|----------|
| 处理速度 | 基准 | 3-8倍提升 |
| 内存使用 | 较低 | 中等（缓冲池） |
| 并发能力 | 串行 | 高并发 |
| 批次管理 | 固定 | 可配置 |
| 错误处理 | 基础 | 增强 |
| 日志记录 | 完整 | 完整 |
| 适用场景 | 小数据集 | 大规模数据 |

## 故障排除

### 常见问题

1. **503错误（服务器过载）**
   - 降低并发数到2-3
   - 减小批次大小到25-50
   - 增加请求间隔

2. **内存不足**
   - 减小缓冲区大小
   - 降低并发数
   - 增加写入频率

3. **Token获取失败**
   - 检查网络连接
   - 验证API凭据

### 性能调优

- **网络良好**: 可提高并发数和批次大小
- **网络不稳定**: 降低并发数，增加重试次数
- **API限流**: 大幅降低并发数，增加请求间隔

## 更新日志

### v3.0.0 (当前版本)
- ✅ 异步爬虫引擎: 基于asyncio的高并发处理
- ✅ 智能批次管理: 可配置批次大小，优化性能
- ✅ 完整日志系统: 所有API请求记录到日志文件
- ✅ 交互式配置: 支持文件选择和批次大小配置
- ✅ 性能对比测试: 内置同步vs异步性能测试
- ✅ 错误处理增强: 智能重试和503错误处理
- ✅ 缓冲池管理: 异步数据缓冲和批量写入

### v2.0.0
- ✅ 重构为面向对象设计
- ✅ 添加多种匹配模式
- ✅ 实现交互式操作
- ✅ 完善日志系统

### v1.0.0
- ✅ 基础匹配功能
- ✅ API集成
- ✅ 数据导出

## 许可证

本项目仅供学习和研究使用。

## 贡献

欢迎提交Issue和Pull Request来改进项目。 